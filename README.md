# 音频录制与总结助手

Chrome 扩展，负责采集麦克风与当前标签页/系统音频，导出 WAV 文件并调用捷丰通用 AI 接口完成客服对话总结。项目内置 sys-/app- 双密钥流程，可直接参考 `api-helpers.js` 中的实现快速接入其它前端或脚本。

## 功能特点
- 同时捕获麦克风与当前标签页音频，支持混合为双声道 WAV。
- 录制完毕后可选择本地保存或一键上传并请求 AI 总结。
- 统一的 API 辅助模块封装了上传、错误码解析与总结调用逻辑，与 Python 版脚本保持一致的双密钥流程。
- 自动提取 `choices[].message.content` 中的文本，界面直接展示 AI 总结结果。

## 使用步骤
1. 在 `api-helpers.js` 中替换为你自己的 `sys-` 与 `app-` Token，并根据需要调整 `MODEL`、`DEFAULT_PROMPT` 与服务端域名。
2. 在 Chrome 中打开 `chrome://extensions/`，启用“开发者模式”，点击“加载已解压的扩展程序”，选择本项目目录。
3. 打开需要录音的页面，点击扩展图标：
   - `开始`：申请设备权限并开始捕获音频。
   - `结束`：停止录制。
   - `保存WAV`：下载本地 WAV 文件。
   - `上传并总结`：调用后台服务上传音频并展示总结结果。
4. 如果后台 Service Worker 离线，前端会自动降级为直接在弹窗内完成上传与总结流程。

## 常见错误码
扩展会针对常见失败场景给出直观提示，部分示例如下：

| 错误码 | 说明 |
| ------ | ---- |
| `fail.login.token.invalid` | sys- Token 无效或已过期，请重新生成。 |
| `fail.http: no such file` | 服务端未接收到文件，确认 FormData 字段名为 `File`。 |
| `fail.uploaded.file.error.type` | 上传类型不在白名单范围内。 |
| `fail.uploaded.file.size` | 文件大小超出限制。 |

除此之外，接口返回的错误消息也会直接透传，方便排查部署或网络问题。

## 关联文件
- `api-helpers.js`：封装上传与总结 API 调用的共享逻辑，前后台脚本都会引用。
- `background.js`：Chrome Service Worker，负责接收弹窗消息并在后台完成上传/总结。
- `popup.js`：弹窗逻辑，控制录音、降级上传及结果展示。

欢迎在现有基础上拓展 UI、录音策略或总结模板。
